<!-- AUTHORITY REGISTRATION INPUTS (for Farms and Farm Operators) -->
<div class="authority-registrar" *ngIf="registrations">
    <table class="table table-striped table-responsive jambo_table bulk_action">
        <thead>
        <tr>
            <th colspan="6">
                <i class="fa fa-file-text"></i>&nbsp; {{title}}
            </th>
        </tr>
        <tr>
            <td>#</td>
            <td>Type *</td>
            <td>Authority *</td>
            <td>Number *</td>
            <td>Document</td>
            <td>Actions</td>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let reg of registrations; index as i">
            <td>{{i + 1}}</td>
            <td>{{findRegType(reg.typeId) ? findRegType(reg.typeId).name : '?'}}</td>
            <td>{{findRegAuth(reg.authorityId) ? findRegAuth(reg.authorityId).name : '?'}}</td>
            <td>{{reg.registrationNumber}}</td>
            <td>
              {{!reg.document ? '[n/a]' : ''}}
              <app-document-detail *ngIf="reg.document" [document]="reg.document"></app-document-detail>
            </td>
            <td>
              <div class="btn-group">
                <a (click)="editReg(i)" class="btn btn-primary btn-sm" role="button" data-toggle="modal" href="#edit-dialog">
                  <i class="fa fa-pencil"></i>
                </a>
                <button (click)="removeReg(i)" class="btn btn-warning btn-sm">
                  <i class="fa fa-trash"></i>
                </button>
              </div>
            </td>
        </tr>
        <tr>
            <td class="text-muted"><i>New</i></td>
            <td>
                <select [(ngModel)]="add_type" title="Reg. Type *" class="form-control" required>
                    <option *ngFor="let type of registrationTypes" [value]="type.id">{{type.name}}</option>
                </select>
            </td>
            <td>
                <select [(ngModel)]="add_authority" title="Reg. Auth *" class="form-control" required>
                    <option *ngFor="let auth of registrationAuthorities" [value]="auth.id">{{auth.name}}</option>
                </select>
            </td>
            <td>
                <input
                  [disabled]="!_noDuplicate"
                  [(ngModel)]="add_number"
                  type="text"
                  placeholder="Reg. Number *"
                  class="form-control"
                >
            </td>
            <td>
                <a href="#add-document-dialog" class="btn btn-default" role="button" type="button" data-toggle="modal">
                  {{add_document.doc ? 'Change Document' : 'Select Document'}}
                </a>
            </td>
            <td>
                <div style="padding-bottom: 10px">
                    <button
                            (click)="addRegistration(docSelector)"
                            class="btn btn-success"
                            [disabled]="!_noDuplicate || this.add_type == undefined || this.add_authority == undefined || this.add_number == undefined"
                    >
                        <i class="fa fa-plus"></i>&nbsp; Add
                    </button>
                </div>
                <div>
                    <a (click)="clear(docSelector)">Clear</a>
                </div>
            </td>
        </tr>
        </tbody>
    </table>
</div>

<div id="add-document-dialog" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title">
          {{add_document.doc ? 'Change Document' : 'Select Document'}}
        </h4>
      </div>
      <div class="modal-body">
        <app-single-document-selector
          #docSelector
          title="Choose a Document"
          [document]="add_document.doc"
          (change)="chooseDocument($event)"
        ></app-single-document-selector>
      </div>
      <div class="modal-footer right">
        <button type="button" class="btn btn-default" (click)="add_document = { doc: null }" data-dismiss="modal" aria-hidden="true">Clear</button>
        <button type="button" class="btn btn-primary" data-dismiss="modal" aria-hidden="true">Save</button>
      </div>
    </div>
  </div>
</div>

<div id="edit-dialog" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title">
          Edit
        </h4>
      </div>
      <div class="modal-body">
        <div style="padding-bottom: 15px">
          <label>Type: *</label>
          <br/>
          <select [(ngModel)]="edit_type" title="Reg. Type *" class="form-control" required>
            <option *ngFor="let type of registrationTypes" [value]="type.id">{{type.name}}</option>
          </select>
        </div>
        <div style="padding-bottom: 15px">
          <label>Authority: *</label>
          <br/>
          <select [(ngModel)]="edit_authority" title="Reg. Auth *" class="form-control" required>
            <option *ngFor="let auth of registrationAuthorities" [value]="auth.id">{{auth.name}}</option>
          </select>
        </div>
        <div style="padding-bottom: 15px">
          <label>Number: *</label>
          <br/>
          <input
            [disabled]="!_noDuplicate"
            [(ngModel)]="edit_number"
            type="text"
            placeholder="Reg. Number *"
            class="form-control"
          >
        </div>

        <div>
          <div *ngIf="!editingEditDocument">
            <span *ngIf="!edit_document.doc">No document was selected previously.</span>
            <app-document-detail *ngIf="edit_document.doc" [document]="edit_document.doc"></app-document-detail>
          </div>
          <div *ngIf="!editingEditDocument" class="right">
            <button class="btn btn-default" (click)="editingEditDocument = true">
              {{edit_document.doc ? 'Edit' : 'Add'}} Document
            </button>
          </div>

          <app-single-document-selector
            *ngIf="editingEditDocument"
            title="Choose a Document"
            [document]="edit_document.doc"
            (change)="chooseEditDocument($event)"
          ></app-single-document-selector>
          <div *ngIf="editingEditDocument" class="right">
            <button class="btn btn-default btn-sm" (click)="editingEditDocument = false">
              Done {{edit_document.doc ? 'Edit' : 'Add'}}ing Document
            </button>
          </div>
        </div>
      </div>
      <div class="modal-footer right">
        <button type="button" class="btn btn-default" (click)="cancelEdit()" data-dismiss="modal" aria-hidden="true">Cancel</button>
        <button type="button" class="btn btn-primary" (click)="doEdit()" data-dismiss="modal" aria-hidden="true">Save</button>
      </div>
    </div>
  </div>
</div>
